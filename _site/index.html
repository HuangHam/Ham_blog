<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Ham_blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-listing/list.min.js"></script>
<script src="site_libs/quarto-listing/quarto-listing.js"></script>
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script>

  window.document.addEventListener("DOMContentLoaded", function (_event) {
    const listingTargetEl = window.document.querySelector('#listing-listing .list');
    if (!listingTargetEl) {
      // No listing discovered, do not attach.
      return; 
    }

    const options = {
      valueNames: ['listing-date','listing-title','listing-author','listing-image','listing-description','listing-categories',{ data: ['index'] },{ data: ['categories'] },{ data: ['listing-date-sort'] },{ data: ['listing-file-modified-sort'] }],
      
      searchColumns: ["listing-date","listing-title","listing-author","listing-image","listing-description","listing-categories"],
    };

    window['quarto-listings'] = window['quarto-listings'] || {};
    window['quarto-listings']['listing-listing'] = new List('listing-listing', options);

    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  });

  window.addEventListener('hashchange',() => {
    if (window['quarto-listing-loaded']) {
      window['quarto-listing-loaded']();
    }
  })
  </script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Ham_blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-page-left">
      <h1 class="title">Ham_blog</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <h5 class="quarto-listing-category-title">Categories</h5><div class="quarto-listing-category category-default"><div class="category" data-category="">All <span class="quarto-category-count">(2)</span></div><div class="category" data-category="analysis">analysis <span class="quarto-category-count">(1)</span></div><div class="category" data-category="code">code <span class="quarto-category-count">(1)</span></div><div class="category" data-category="news">news <span class="quarto-category-count">(2)</span></div></div></div>
<!-- main -->
<main class="content quarto-banner-title-block column-page-left" id="quarto-document-content">




<section id="what-is-hbayesdm" class="level2">
<h2 class="anchored" data-anchor-id="what-is-hbayesdm">What is HBayesDM</h2>
<p>Computational modeling is a growing approach in cognitive and behavioral sciences. Computational modeling is commonly distinguished from regular statistical modeling (like linear regression, t-test) by serving as in some sense a “process model” of cognition rather than mere quantitative checks on whether an effect is legitimate. However, the boundary between a statistical model and a computational model is often quite blurry. In many usage cases, well-established frameworks of computational models function as statistical models to examine effects of certain experimental manipulations. This is especially truth in the field of learning and decision-making where a wealth of established computational models under the framework of value-based decision-making and reinforcement learning exist. However, computational modeling often require a researcher to program the models from scratch because of the lack of easily accessible packages like for linear regressions and t tests. This creates a high barriers for entry. HBayesDM is a nice package created to address this issue by packaging up a wide sort of well-validated computational models of learning and decision-making so that people can easily call on them in their research just like calling on a statistical model. Moreover, this package performs Bayesian fitting for these models. Computational models in decision-making often have unconstrained parameter space and rugged terrain of likelihood function. This makes regularization important for create interpretable parameter fits. Among other advantageous, Bayesian model fitting is a very flexible and effective way of regularization.Therefore HBayesDM is a useful package for researchers in learning decision-making to leverage decades of research in computational modeling to advance of understanding of the mechanisms behind how people (and other animals) make decisions!</p>
<p>While there already exists many good blogs on the internet for how to use different kind of computational models supported by the package, in this blog I will focus on demonstrating the model I am personal most familiar with, which is the Rescorla-Wagner model of the 2-armed bandit task.</p>
</section>
<section id="load-packages-and-data" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-and-data">Load packages and data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># precompile the models if you are a frequent use. It makes fitting models quicker</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Sys.setenv(BUILD_ALL='true')  # Build all the models on installation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Sys.setenv(MAKEFLAGS='-j 4')  # Use 4 cores for compilation (or the number you want)</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># install the package</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages("hBayesDM", dependencies=TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(hBayesDM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: Rcpp</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>

This is hBayesDM version 1.2.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load the example bandit task data</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dataPath <span class="ot">=</span> <span class="fu">system.file</span>(<span class="st">"extdata/bandit2arm_exampleData.txt"</span>, <span class="at">package=</span><span class="st">"hBayesDM"</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">=</span> <span class="fu">read.table</span>(dataPath, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove NA's if there is NA data.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="what-is-a-2-armed-bandit-task" class="level2">
<h2 class="anchored" data-anchor-id="what-is-a-2-armed-bandit-task">What is a 2-armed bandit task?</h2>
<p>A 2-armed bandit task is the simplest and most classic set up for the study of reinforcement learning in humans. Reinforcement learning refers to the ability to learn from rewards. In other words, people will be able to learn overtime which action yields more reward and increase their frequencies of taking that action. In a 2-armed bandit task, there are 2 possible actions to take. Each action corresponding to playing an imaginary bandit machine once. A bandit machine is kind of casino machine that probabilistically spit out reward each time you play it. By playing it I mean pulling the lever or pressing a key on the key board. In sum, the set up is quite simple. For each participant, there are two options (or two keys to press if you will). At each trial, they can press one of the two keys. Each time they do so, they will either get an reward, or loss a reward. They do so for 100 times. The data has 4 variables:</p>
<ul>
<li><p><strong>subjID</strong>: The participant’s id</p></li>
<li><p><strong>trial</strong>: which trial</p></li>
<li><p><strong>choice</strong>: the key that the participant pressed at that trial. It can be either the 1st bandit machine or the 2nd.</p></li>
<li><p><strong>outcome</strong>: making that choice either gave the participant one more unit of reward (1) or lose one unite of reward (-1).</p></li>
</ul>
</section>
<section id="the-rescorla-wagner-model" class="level2">
<h2 class="anchored" data-anchor-id="the-rescorla-wagner-model">The Rescorla-Wagner Model</h2>
<p>The Rescorla-Wagner model is the simplest computational model of reinforcement learning. There are so many variants of this simple model that incorporate other cognitive mechanisms but Rescorla-wagner model really sets the framework here. This model has 2 parameters: the learning rate A and the inverse temperature tau. The model assumes that the learning agent stores a value representation of each of the options (bandits). If by choosing an option, the agent gains a reward, then the value associated with that option increases by 1 times A. If the agent instead receives a loss, then the value associated will decrease by 1 times A or increase by -1 times A. Here learning rate A controls how sensitive is the agent to the incoming reward information. High learning rate A means the agent reacts really quickly to each new reward information. Thus the agent learns really quickly. While low learning rate A corresponds to an agent the learns more slowly. The values were initialized to be uniform.</p>
<p>At each trial, the agent choose each option according to the values of each option. The higher the value, the more likely the agent would choose it, corresponding to the process of reinforcement learning. The exactly probability distribution from which the choice is sampled is determined by applying the softmax function to the values. What softmax function does is nothing but converting an array of number that does sum up to 1, into an array of number that does. Softmax function can be thought of as a generalization of logistic function. In the case of a 2-armed bandit it exactly is equivalent to a logistic function. The softmax function takes in one parameter called inverse temperature. You may ask why inverse temperature. Because this softmax function originates in thermodynamics where people study temperature (sorry this is as much I know about thermodynamics haha). Higher temperature, things are noisier so behavior is more random. In the softmax function, higher the temperature (lower the inverse temperature), the more random the choice. In the extreme if the temperature is infinite (or the inverse temperature is 0), then the agent always just randomly choose an option, regardless of the learned value. On the contrary with low temperature ( an high inverse temperature), the agent always chooses the most rewarding option. The reason why the model takes in the inverse of temperature as a parameter is for numeric stability of calculation mostly.</p>
<p>These two parameter are not orthogonal and they are very much correlated. Let is consider extreme cases. If A = 0, then no matter what tau is, the agent always chooses randomly, because it does not update values and the value for each option remains the same (as initialized). If tau = 0. then the agent entirely ignores the values and also choose randomly always. Therefore from mere behavioral data one cannot tell if the agent has A=0 or tau=0. This correlation makes Bayesian fitting extra valuable because it entails that many pairs of A and tau could fit the data equally well. However, having crazy values of parameters do not really help interpretation. After all, these 2 parameters do capture different cognitive processes. A manefasts how sensitive is an agent to reward signals, whereas tau reveals overall how “exploratory” an agent is.</p>
</section>
<section id="fit-the-model-using-hbayesdm" class="level2">
<h2 class="anchored" data-anchor-id="fit-the-model-using-hbayesdm">Fit the model using HBayesDM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>output <span class="ot">=</span> <span class="fu">bandit2arm_delta</span>(</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="st">"example"</span>, <span class="at">niter =</span> <span class="dv">2000</span>, <span class="at">nwarmup =</span> <span class="dv">1000</span>, <span class="at">nchain =</span> <span class="dv">4</span>, <span class="at">ncore =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model name  = bandit2arm_delta 
Data file   = example 

Details:
 # of chains                    = 4 
 # of cores used                = 4 
 # of MCMC samples (per chain)  = 2000 
 # of burn-in samples           = 1000 
 # of subjects                  = 20 
 # of (max) trials per subject  = 100 


****************************************
** Use VB estimates as initial values **
****************************************
Chain 1: ------------------------------------------------------------
Chain 1: EXPERIMENTAL ALGORITHM:
Chain 1:   This procedure has not been thoroughly tested and may be unstable
Chain 1:   or buggy. The interface is subject to change.
Chain 1: ------------------------------------------------------------
Chain 1: 
Chain 1: 
Chain 1: 
Chain 1: Gradient evaluation took 0.000454 seconds
Chain 1: 1000 transitions using 10 leapfrog steps per transition would take 4.54 seconds.
Chain 1: Adjust your expectations accordingly!
Chain 1: 
Chain 1: 
Chain 1: Begin eta adaptation.
Chain 1: Iteration:   1 / 250 [  0%]  (Adaptation)
Chain 1: Iteration:  50 / 250 [ 20%]  (Adaptation)
Chain 1: Iteration: 100 / 250 [ 40%]  (Adaptation)
Chain 1: Iteration: 150 / 250 [ 60%]  (Adaptation)
Chain 1: Iteration: 200 / 250 [ 80%]  (Adaptation)
Chain 1: Success! Found best value [eta = 1] earlier than expected.
Chain 1: 
Chain 1: Begin stochastic gradient ascent.
Chain 1:   iter             ELBO   delta_ELBO_mean   delta_ELBO_med   notes 
Chain 1:    100        -1295.075             1.000            1.000
Chain 1:    200        -1298.594             0.501            1.000
Chain 1:    300        -1288.960             0.337            0.007   MEDIAN ELBO CONVERGED
Chain 1: 
Chain 1: Drawing a sample of size 1000 from the approximate posterior... 
Chain 1: COMPLETED.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Pareto k diagnostic value is 0.85. Resampling is unreliable.
Increasing the number of draws or decreasing tol_rel_obj may help.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
************************************
**** Model fitting is complete! ****
************************************</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: here I didn't set data=df because there is a bug in the package for the newest R version. It would have worked for R 4.1. This bug stil awaits to be fixed for the newest R version. But setting data="example" does the same thing and used this example dataset.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now the model is fit! How simple! Just one line like fitting a regression model. Let us quick check if the model fitting worked.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(output, <span class="at">type=</span><span class="st">"trace"</span>, <span class="at">fontSize=</span><span class="dv">11</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The trace plot looked like catepillars! So the Bayesian fitted was decent. We can proceed to interpret the parameters.</p>
</section>
<section id="unpack-the-output" class="level2">
<h2 class="anchored" data-anchor-id="unpack-the-output">Unpack the output</h2>
<p>First, let us to at the fitted parameters. Below you see the fitted A and tau for each subject. The estimates are means of the posterior distribution.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>allIndPars</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   subjID         A       tau
1       1 0.3561810 0.7280456
2       2 0.3456318 0.7647481
3       3 0.3754597 0.7000733
4       4 0.3708238 0.7527602
5       5 0.3581892 0.7400297
6       6 0.3508396 0.8541431
7       7 0.3851224 1.0031085
8       8 0.3846750 0.8058465
9       9 0.3585976 0.8004985
10     10 0.3684237 0.8563626
11     11 0.3412473 0.9146940
12     12 0.3748351 0.7778413
13     13 0.3499101 0.8217206
14     14 0.3530653 0.6558828
15     15 0.3591910 0.8080967
16     16 0.3372613 0.7980661
17     17 0.3729282 0.9712159
18     18 0.3432543 0.7091264
19     19 0.3747407 0.8550077
20     20 0.3862169 1.0020158</code></pre>
</div>
</div>
<p>If you are interested in the detailed outcome of Bayesian fitting, you can run</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Inference for Stan model: anon_model.
4 chains, each with iter=2000; warmup=1000; thin=1; 
post-warmup draws per chain=1000, total post-warmup draws=4000.

                mean se_mean   sd     2.5%      25%      50%      75%    97.5%
mu_A            0.36    0.00 0.05     0.26     0.32     0.36     0.40     0.47
mu_tau          0.80    0.00 0.09     0.64     0.75     0.80     0.86     0.99
sigma[1]        0.14    0.00 0.10     0.01     0.06     0.13     0.20     0.37
sigma[2]        0.14    0.00 0.08     0.01     0.09     0.14     0.19     0.30
A[1]            0.36    0.00 0.08     0.21     0.31     0.35     0.40     0.53
A[2]            0.35    0.00 0.07     0.19     0.30     0.35     0.39     0.49
A[3]            0.38    0.00 0.08     0.23     0.32     0.37     0.42     0.55
A[4]            0.37    0.00 0.08     0.23     0.32     0.37     0.42     0.54
A[5]            0.36    0.00 0.08     0.20     0.31     0.36     0.41     0.52
A[6]            0.35    0.00 0.08     0.20     0.30     0.35     0.40     0.51
A[7]            0.39    0.00 0.07     0.26     0.34     0.38     0.43     0.55
A[8]            0.38    0.00 0.08     0.25     0.33     0.38     0.43     0.56
A[9]            0.36    0.00 0.08     0.21     0.31     0.36     0.41     0.52
A[10]           0.37    0.00 0.09     0.21     0.31     0.36     0.42     0.55
A[11]           0.34    0.00 0.07     0.19     0.29     0.34     0.39     0.49
A[12]           0.37    0.00 0.08     0.24     0.32     0.37     0.42     0.55
A[13]           0.35    0.00 0.07     0.21     0.31     0.35     0.39     0.48
A[14]           0.35    0.00 0.08     0.20     0.30     0.35     0.40     0.51
A[15]           0.36    0.00 0.08     0.21     0.31     0.36     0.41     0.53
A[16]           0.34    0.00 0.08     0.18     0.29     0.34     0.39     0.48
A[17]           0.37    0.00 0.08     0.24     0.32     0.37     0.42     0.54
A[18]           0.34    0.00 0.08     0.18     0.30     0.34     0.39     0.50
A[19]           0.37    0.00 0.07     0.24     0.32     0.37     0.42     0.54
A[20]           0.39    0.00 0.08     0.26     0.33     0.38     0.43     0.56
tau[1]          0.73    0.00 0.15     0.44     0.63     0.73     0.82     1.01
tau[2]          0.76    0.00 0.17     0.43     0.66     0.77     0.86     1.11
tau[3]          0.70    0.00 0.15     0.39     0.61     0.71     0.80     0.97
tau[4]          0.75    0.00 0.16     0.42     0.65     0.75     0.85     1.08
tau[5]          0.74    0.00 0.16     0.42     0.64     0.74     0.84     1.05
tau[6]          0.85    0.00 0.19     0.53     0.74     0.83     0.95     1.29
tau[7]          1.00    0.00 0.21     0.69     0.85     0.97     1.12     1.49
tau[8]          0.81    0.00 0.16     0.49     0.71     0.80     0.90     1.17
tau[9]          0.80    0.00 0.16     0.49     0.70     0.79     0.89     1.15
tau[10]         0.86    0.00 0.16     0.58     0.75     0.84     0.94     1.21
tau[11]         0.91    0.00 0.18     0.62     0.79     0.89     1.02     1.33
tau[12]         0.78    0.00 0.13     0.52     0.69     0.78     0.86     1.04
tau[13]         0.82    0.00 0.18     0.50     0.71     0.81     0.92     1.20
tau[14]         0.66    0.00 0.15     0.35     0.55     0.66     0.76     0.93
tau[15]         0.81    0.00 0.18     0.47     0.70     0.80     0.91     1.21
tau[16]         0.80    0.00 0.16     0.49     0.70     0.80     0.89     1.14
tau[17]         0.97    0.00 0.21     0.65     0.82     0.94     1.09     1.45
tau[18]         0.71    0.00 0.16     0.38     0.60     0.72     0.82     1.01
tau[19]         0.86    0.00 0.17     0.55     0.74     0.84     0.95     1.24
tau[20]         1.00    0.00 0.25     0.65     0.82     0.95     1.13     1.63
log_lik[1]    -66.17    0.01 0.49   -67.49   -66.34   -66.02   -65.83   -65.72
log_lik[2]    -67.44    0.01 0.44   -68.65   -67.59   -67.32   -67.14   -66.99
log_lik[3]    -67.09    0.01 0.73   -68.80   -67.51   -66.98   -66.56   -65.98
log_lik[4]    -68.00    0.01 0.45   -69.06   -68.21   -67.92   -67.69   -67.40
log_lik[5]    -67.43    0.01 0.45   -68.65   -67.58   -67.29   -67.13   -66.98
log_lik[6]    -63.87    0.01 0.46   -64.90   -64.12   -63.83   -63.58   -63.03
log_lik[7]    -53.81    0.02 1.08   -56.25   -54.56   -53.65   -52.93   -52.31
log_lik[8]    -64.80    0.01 0.56   -66.06   -65.15   -64.75   -64.41   -63.87
log_lik[9]    -64.83    0.01 0.27   -65.62   -64.88   -64.74   -64.68   -64.61
log_lik[10]   -59.05    0.01 0.45   -60.25   -59.17   -58.90   -58.78   -58.57
log_lik[11]   -57.93    0.01 0.87   -59.83   -58.44   -57.84   -57.33   -56.46
log_lik[12]   -60.92    0.01 0.48   -62.19   -61.11   -60.80   -60.60   -60.35
log_lik[13]   -64.89    0.01 0.43   -66.00   -65.08   -64.78   -64.58   -64.40
log_lik[14]   -68.89    0.02 0.99   -71.15   -69.51   -68.70   -68.10   -67.63
log_lik[15]   -66.29    0.01 0.26   -66.98   -66.34   -66.22   -66.15   -66.04
log_lik[16]   -64.05    0.01 0.60   -65.34   -64.42   -64.01   -63.63   -63.05
log_lik[17]   -56.31    0.02 0.87   -58.35   -56.86   -56.18   -55.60   -55.17
log_lik[18]   -68.99    0.01 0.64   -70.47   -69.34   -68.89   -68.50   -68.14
log_lik[19]   -62.63    0.01 0.44   -63.81   -62.79   -62.50   -62.32   -62.17
log_lik[20]   -60.35    0.02 1.09   -62.55   -61.12   -60.33   -59.52   -58.44
lp__        -1299.11    0.16 5.67 -1311.05 -1302.70 -1298.82 -1295.09 -1288.87
            n_eff Rhat
mu_A         3769    1
mu_tau       2830    1
sigma[1]     2602    1
sigma[2]     1594    1
A[1]         4009    1
A[2]         4172    1
A[3]         3966    1
A[4]         4423    1
A[5]         4131    1
A[6]         4049    1
A[7]         4377    1
A[8]         3793    1
A[9]         3290    1
A[10]        3832    1
A[11]        3796    1
A[12]        4556    1
A[13]        4630    1
A[14]        3672    1
A[15]        4051    1
A[16]        4019    1
A[17]        4842    1
A[18]        3785    1
A[19]        4941    1
A[20]        4327    1
tau[1]       3998    1
tau[2]       4597    1
tau[3]       3565    1
tau[4]       4611    1
tau[5]       4453    1
tau[6]       4550    1
tau[7]       2805    1
tau[8]       5610    1
tau[9]       5042    1
tau[10]      5329    1
tau[11]      4096    1
tau[12]      5882    1
tau[13]      5194    1
tau[14]      2814    1
tau[15]      4540    1
tau[16]      4267    1
tau[17]      3479    1
tau[18]      3409    1
tau[19]      4855    1
tau[20]      3161    1
log_lik[1]   3562    1
log_lik[2]   3930    1
log_lik[3]   3642    1
log_lik[4]   3453    1
log_lik[5]   3402    1
log_lik[6]   3052    1
log_lik[7]   2516    1
log_lik[8]   3158    1
log_lik[9]   2183    1
log_lik[10]  2648    1
log_lik[11]  3491    1
log_lik[12]  2968    1
log_lik[13]  3336    1
log_lik[14]  2834    1
log_lik[15]  2178    1
log_lik[16]  3473    1
log_lik[17]  3022    1
log_lik[18]  4553    1
log_lik[19]  3131    1
log_lik[20]  2913    1
lp__         1296    1

Samples were drawn using NUTS(diag_e) at Fri May  3 22:00:18 2024.
For each parameter, n_eff is a crude measure of effective sample size,
and Rhat is the potential scale reduction factor on split chains (at 
convergence, Rhat=1).</code></pre>
</div>
</div>
<p>This gives you the summary of full posterior distribution of each random variable in the Bayesian hierarchical model. If you are only interested in the point estimate of the parameters, you can just go with output$allIndPars. Let us visualize the fitted parameters. HBayesDM comes with a easy plot function as well!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(output)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: The dot-dot notation (`..density..`) was deprecated in ggplot2 3.4.0.
ℹ Please use `after_stat(density)` instead.
ℹ The deprecated feature was likely used in the hBayesDM package.
  Please report the issue at &lt;https://github.com/CCS-Lab/hBayesDM/issues&gt;.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If you want to visualize the full posterior for each participant you can also do that:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInd</span>(output, <span class="st">"A"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ci_level: 0.8 (80% intervals)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outer_level: 0.95 (95% intervals)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotInd</span>(output, <span class="st">"tau"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>ci_level: 0.8 (80% intervals)</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>outer_level: 0.95 (95% intervals)</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, if you want to compare the overall parameter fit of a group of participant and compare it with another group of participant, you can directly compare the posterior of the mean. This could be useful for example in computational psychiatry, researchers may be interested in comparing the learning rate between people with depression and neurotypical people. Because we only have one example dataset, let us just compare this 20 subjects in our example data to itself, just for the sake of demonstrating the code.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for the learning rate </span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>diffDist <span class="ot">=</span> output<span class="sc">$</span>parVals<span class="sc">$</span>mu_A <span class="sc">-</span> output<span class="sc">$</span>parVals<span class="sc">$</span>mu_A</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">HDIofMCMC</span>( diffDist ) <span class="co"># get the 95% density interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHDI</span>( diffDist ) <span class="co"># plot the differences of the group mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "95% Highest Density Interval (HDI):"
[1] "Lower bound = 0, Upper bound = 0"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = HDI[1], y = 0, xend = HDI[2], yend = 0), : All aesthetics have length 1, but the data has 4000 rows.
ℹ Did you mean to use `annotate()`?</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co">#for the inverse temperature</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>diffDist <span class="ot">=</span> output<span class="sc">$</span>parVals<span class="sc">$</span>mu_tau <span class="sc">-</span> output<span class="sc">$</span>parVals<span class="sc">$</span>mu_tau</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="fu">HDIofMCMC</span>( diffDist ) <span class="co"># get the 95% density interval</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plotHDI</span>( diffDist ) <span class="co"># plot the differences of the group mean</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "95% Highest Density Interval (HDI):"
[1] "Lower bound = 0, Upper bound = 0"</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in geom_segment(aes(x = HDI[1], y = 0, xend = HDI[2], yend = 0), : All aesthetics have length 1, but the data has 4000 rows.
ℹ Did you mean to use `annotate()`?</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>You may wonder, why do we have parameter fits to each individual subject AND a parameter fit to the entire sample? This is akin to the hierarchical modeling in general linear regression (or mixed-effects modeling). In fact, the framework is exactly the same. You could fit the hierarchical models in a Bayesian we as well using brms package. The mu_[parameter] you get from the model fit is analogous of the fixed-effects and the individual fits are analogous to the random effects. However, some papers also just ignore the mean group estimates and instead just average the individual fits and treat those as point estimates, similar to what you would do in frequentist model-fitting. Both ways are probably more or less equivalent. Since HBayesDM already nicely give you this posterior group mean estimates, why not just use it? This concludes my blog that introduces you to how to fit a simple reinforcement learning model using HBayesDM. This package as a rich repertoire of other common computational models in learning and decision-making, and the usage should be more or less the same. However, if your work requires you to build a novel model that doesn’t exist in this repertoire, HBayesDM may not work for you. For example, if you are interested in combining this reinforcement learning model with a utility function, you may need to write up your own model. Nevertheless, HBayesDM is still a powerful package for research that mainly wants to leverage these tasks and computational models as tools or in other words, statistical models, to examine questions in social, clinical, or model-based cognitive neuroscience. It makes the outputs of research in computational modeling much more accessible to a wide range of researchers.</p>



</section>

<div class="quarto-listing quarto-listing-container-default" id="listing-listing">
<div class="list quarto-listing-default">
<div class="quarto-post image-right" data-index="0" data-categories="news,code,analysis" data-listing-date-sort="1714708800000" data-listing-file-modified-sort="1714787922470" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="1">
<div class="thumbnail">
<p><a href="./posts/post-with-code/index.html"> <img src="./posts/post-with-code/image.jpg" class="thumbnail-image"> </a></p>
</div>
<div class="body">
<a href="./posts/post-with-code/index.html">
<h3 class="no-anchor listing-title">
Post With Code
</h3>
<div class="listing-subtitle">

</div>
</a>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('news'); return false;">
news
</div>
<div class="listing-category" onclick="window.quartoListingCategory('code'); return false;">
code
</div>
<div class="listing-category" onclick="window.quartoListingCategory('analysis'); return false;">
analysis
</div>
</div>
<a href="./posts/post-with-code/index.html">
<div class="listing-description">
This is a post with executable code.
</div>
</a>
</div>
<div class="metadata">
<a href="./posts/post-with-code/index.html">
<div class="listing-date">
May 3, 2024
</div>
<div class="listing-author">
Harlow Malloc
</div>
</a>
</div>
</div>
<div class="quarto-post image-right" data-index="1" data-categories="news" data-listing-date-sort="1714449600000" data-listing-file-modified-sort="1714787922469" data-listing-date-modified-sort="NaN" data-listing-reading-time-sort="1">
<div class="thumbnail">
<p><a href="./posts/welcome/index.html"> <p class="card-img-top"><img src="posts/welcome/thumbnail.jpg"  class="thumbnail-image card-img"/></p> </a></p>
</div>
<div class="body">
<a href="./posts/welcome/index.html">
<h3 class="no-anchor listing-title">
Welcome To My Blog
</h3>
<div class="listing-subtitle">

</div>
</a>
<div class="listing-categories">
<div class="listing-category" onclick="window.quartoListingCategory('news'); return false;">
news
</div>
</div>
<a href="./posts/welcome/index.html">
<div class="listing-description">
This is the first post in a Quarto blog. Welcome!
</div>
</a>
</div>
<div class="metadata">
<a href="./posts/welcome/index.html">
<div class="listing-date">
Apr 30, 2024
</div>
<div class="listing-author">
Tristan O’Malley
</div>
</a>
</div>
</div>
</div>
<div class="listing-no-matching d-none">
No matching items
</div>
</div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>